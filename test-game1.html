<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>3x3 拼圖遊戲 - 拖拉版</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #f0f0f0;
    font-family: sans-serif;
    margin: 0;
  }

  #puzzle {
    width: 300px;
    height: 300px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 2px;
    position: relative;
    touch-action: none; /* 支援觸控拖拉 */
  }

  .piece {
    width: 100%;
    height: 100%;
    background-image: url('images/Coffee.jpg'); /* 換成你的圖片 */
    background-size: 300px 300px;
    border-radius: 8px;
    cursor: grab;
    position: relative;
    z-index: 1;
    transition: transform 0.2s;
    touch-action: none;
  }

  /* 模擬 jigsaw 凸凹 */
  #piece-0 { background-position: 0 0; clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%); }
  #piece-1 { background-position: -100px 0; clip-path: polygon(0% 0%, 100% 10%, 100% 100%, 0% 90%); }
  #piece-2 { background-position: -200px 0; clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%); }
  #piece-3 { background-position: 0 -100px; clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 10% 100%); }
  #piece-4 { background-position: -100px -100px; clip-path: polygon(0% 10%, 100% 0%, 90% 100%, 10% 90%); }
  #piece-5 { background-position: -200px -100px; clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 90% 100%); }
  #piece-6 { background-position: 0 -200px; clip-path: polygon(0% 0%, 100% 0%, 100% 90%, 0% 100%); }
  #piece-7 { background-position: -100px -200px; clip-path: polygon(0% 10%, 100% 0%, 100% 90%, 0% 100%); }
  #piece-8 { background-position: -200px -200px; clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%); }
</style>
</head>
<body>

<div id="puzzle">
  <div class="piece" id="piece-0" data-index="0"></div>
  <div class="piece" id="piece-1" data-index="1"></div>
  <div class="piece" id="piece-2" data-index="2"></div>
  <div class="piece" id="piece-3" data-index="3"></div>
  <div class="piece" id="piece-4" data-index="4"></div>
  <div class="piece" id="piece-5" data-index="5"></div>
  <div class="piece" id="piece-6" data-index="6"></div>
  <div class="piece" id="piece-7" data-index="7"></div>
  <div class="piece" id="piece-8" data-index="8"></div>
</div>

<script>
const puzzle = document.getElementById('puzzle');
const pieces = Array.from(document.querySelectorAll('.piece'));

// 打亂拼圖
function shuffle() {
  pieces.sort(() => Math.random() - 0.5);
  pieces.forEach(piece => puzzle.appendChild(piece));
}
shuffle();

// 追蹤拖拉
let dragging = null;
let offsetX = 0;
let offsetY = 0;

// Pointer Events 支援滑鼠/觸控
pieces.forEach(piece => {
  piece.addEventListener('pointerdown', e => {
    dragging = piece;
    offsetX = e.clientX - piece.getBoundingClientRect().left;
    offsetY = e.clientY - piece.getBoundingClientRect().top;
    piece.style.zIndex = 1000;
    piece.setPointerCapture(e.pointerId);
  });

  piece.addEventListener('pointermove', e => {
    if (!dragging) return;
    const x = e.clientX - offsetX - puzzle.getBoundingClientRect().left;
    const y = e.clientY - offsetY - puzzle.getBoundingClientRect().top;
    dragging.style.transform = `translate(${x}px, ${y}px)`;
  });

  piece.addEventListener('pointerup', e => {
    if (!dragging) return;

    const draggingRect = dragging.getBoundingClientRect();
    let swapped = false;

    pieces.forEach(target => {
      if (target === dragging) return;
      const rect = target.getBoundingClientRect();
      if (
        e.clientX > rect.left &&
        e.clientX < rect.right &&
        e.clientY > rect.top &&
        e.clientY < rect.bottom
      ) {
        // 交換 DOM 位置
        const temp = document.createElement('div');
        puzzle.insertBefore(temp, target);
        puzzle.insertBefore(target, dragging);
        puzzle.insertBefore(dragging, temp);
        temp.remove();
        swapped = true;
      }
    });

    // 重置位置
    dragging.style.transform = '';
    dragging.style.zIndex = 1;
    dragging.releasePointerCapture(e.pointerId);
    dragging = null;

    checkWin();
  });
});

// 判斷完成
function checkWin() {
  const ids = Array.from(puzzle.children).map(p => p.dataset.index);
  if (ids.join(',') === '0,1,2,3,4,5,6,7,8') {
    setTimeout(() => alert('恭喜完成拼圖！'), 100);
  }
}
</script>

</body>
</html>

